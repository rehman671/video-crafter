{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'styles/manage-subs.css' %}">
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'styles/main.css' %}">
    <link rel="icon" href="{% static 'images/iconlogo.svg' %}">
    <title>VideoCrafter.io</title>
</head>
<body>
    <header class="header">
        <div class="main-div">
            <div class="sub-main-div">
                <img src="{% static 'images/logo.svg' %}" alt="Logo">
                <a href="{% url 'preview' %}" class="anchor-sub-main"></a>
            </div>
            <div class="right">
                <span class="right-span">Credits Remaining: <span id="number">{{ user_subscription.unused_credits }}</span></span>
                <div class="line"></div>
                <div class="img" id="pfp" onclick="toggleDropdown()">
                    <div class="img-sub-div">
                        <div class="img-sub">
                            <img src="{% static 'images/profile.svg' %}" alt="Profile">
                        </div>
                    </div>
                </div>

                <div id="pfpdropdown" class="not-present">
                    <div class="not-present-sub">
                        <span class="not-present-sub-span1">{{ user_subscription.user.first_name }}</span>
                        <span class="not-present-sub-span2">{{ user_subscription.user.email }}</span>
                    </div>
                    <div class="profile-main-div">
                        <div class="profile-sub-div">
                            <div class="dropdownText">
                                <span class="dropdownText" style="width: fit-content;">Credit Left</span>
                                <span class="dropdownText" style="width: fit-content; color: #19191980;">{{ user_subscription.unused_credits }}</span>
                            </div>
                        </div>
                        <span class="dropdownText">
                            <a href="{% url 'asset_library' %}">Manage Asset Library</a>
                        </span>
                        <span class="dropdownText">
                            <a href="{% url 'recent_videos' %}">Manage Video Drafts</a>
                        </span>
                        <span class="dropdownText">
                            <a href="{% url 'manage_subscription' %}">Manage Subscription</a>
                        </span>
                    </div>
                    <div class="profile-last-div">
                        <span class="dropdownText"><a href="/">Log Out</a></span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="main-sub">
        <div class="outer">
            <div class="info-header">
                <h3>Subscription Details</h3>
                <a href="{% url 'billing_portal' %}" class="link-tag">Manage Billing Info</a>
            </div>

            <div class="inner">
                <div class="section">
                    <p>Current Plan:</p>
                    <p class="btn">{{ user_subscription.plan.name|default:"Cancelled" }}</p>
                </div>

                <div class="section">
                    <p>Subscription Status:</p>
                    <p class="btn">{{ user_subscription.status|title|default:"Not Active" }}</p>
                </div>

                <div class="section">
                    <p class="credit-header">Credit Usage</p>
                    <div class="credit-info">
                        {% if user_subscription.status == 'active' %}
                            <p>You have {{ user_subscription.unused_credits }} credits remaining on your {{ user_subscription.plan.name }} plan.</p>
                        {% else %}
                            <p>You currently do not have an active plan.</p>
                        {% endif %}
                        <p>Unused credits will expire in {{ user_subscription.days_until_expiry|default:"0" }} Days</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="second-main">
            <div class="heading">Need More Credits?</div>
            <p>
                Out of Videos edits? No worries! Add more edits to your account
                instantly. Choose the number of extra edits you need, with a
                minimum of 5, and keep creating high-converting Videos without
                delays.
            </p>
        </div>

        <div class="credit-box">
            <div class="box-cont">
                <form action="/accounts/add-credits" method="post">
                    {% csrf_token %}
                    <p class="cr">Buy More Credits</p>
                    <p>${{ user_subscription.plan.credits_price|default:"0.00" }} Each</p>
                    <input
                        type="number"
                        min="1"
                        name="credits_number"
                        id="credit"
                        required
                        placeholder="Enter the amount of credits"
                    >
                    <button type="submit" {% if not user_subscription.status == 'active' or 'free' in user_subscription.plan.name|lower %}disabled{% endif %}>Buy</button>
                </form>
            </div>
        </div>

        <div class="main-head">
            <h1>Plans that scale with your business</h1>
        </div>

        <div class="plans">
            {% for plan in plans %}
            {% if not plan.name|lower == 'free' %}
            <div class="box">
                <p class="box-head">{{ plan.name }} Plan</p>
                {% if plan.name == "Growth" %}
                <p id="p">Perfect for scaling your video advertising campaigns</p>
                {% elif plan.name == "Pro" %}
                <p id="p">Ideal for high-volume marketers and agencies</p>  
                {% else %}
                <p id="p">{{ plan.description }}</p>
                {% endif %}
                <br>
                <div class="price">
                    <h1>${{ plan.price_per_month }}.00</h1>
                    <span>/Month</span>
                </div>
                <p id="p">Just ${{ plan.price_per_month|floatformat:2|default:"0.00" }} per Video</p>
                <p id="p" style="min-height: 70px;">
                    <img
                        src="{% static 'images/check.svg' %}"
                        alt="Check icon"
                        class="check-icon"
                        style="padding-left: 5px;"
                    > Create up to {{ plan.ad_variations_per_month }} Videos per month
                </p>
                <a href="{% url 'upgrade_plan' plan_id=plan.id %}" class="link-tag">
                    {% if user_subscription.plan.id == plan.id %}
                        Current Plan
                    {% elif plan.price_per_month < user_subscription.plan.price_per_month %}
                        Downgrade Subscription
                    {% else %}
                        Upgrade Subscription
                    {% endif %}
                </a>
            </div>
            {% endif %}
            {% empty %}
            <div class="box">
                <p class="box-head">Growth Plan</p>
                <p id="p">Perfect for scaling your video advertising campaigns</p>
                <br>
                <div class="price">
                    <h1>$497.00</h1>
                    <span>/Month</span>
                </div>
                <p id="p">Just $19.88 per Video</p>
                <p id="p" style="min-height: 70px;">
                    <img
                        src="{% static 'images/check.svg' %}"
                        alt="Check icon"
                        class="check-icon"
                        style="padding-left: 5px;"
                    > Create up to 25 Videos per month
                </p>
                <a href="#" class="link-tag">Upgrade Subscription</a>
            </div>

            <div class="box">
                <p class="box-head">Pro Plan</p>
                <p id="p">Ideal for high-volume marketers and agencies</p>
                <br>
                <div class="price">
                    <h1>$997.00</h1>
                    <span>/Month</span>
                </div>
                <p id="p">Just $16.62 per Video</p>
                <p id="p" style="min-height: 70px;">
                    <img
                        src="{% static 'images/check.svg' %}"
                        alt="Check icon"
                        class="check-icon"
                        style="padding-left: 5px;"
                    > Create up to 60 Videos per month
                </p>
                <a href="#" class="link-tag">Upgrade Subscription</a>
            </div>
            {% endfor %}
        </div>
    </div>
    <script src="{% static 'js/header-toggle.js' %}"></script>
</body>
</html>